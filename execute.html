<script>
  // function match(string) {
  //   let foundA = false
  //   let foundB = false
  //   let foundC = false
  //   let foundD = false
  //   let foundE = false
  //   for (let char of string) {
  //     if (char == 'a')
  //       foundA = true
  //     else if (foundA && char == 'b')
  //       foundB = true
  //     else if (foundB && char == 'c')
  //       foundC = true
  //     else if (foundC && char == 'd')
  //       foundD = true
  //     else if (foundD && char == 'e')
  //       foundE = true
  //     else if (foundD && char == 'f')
  //       return true
  //     else {
  //       let foundA = false
  //       let foundB = false
  //       let foundC = false
  //       let foundD = false
  //       let foundE = false
  //     }
  //   }
  //   return false
  // }
  // match("I aabcdefghm grood.")

  // function match(string) {
  //   let state = start
  //   for (let char of string) {
  //     state = state(char)
  //   }
  //   return state === end
  // }
  // function start(char) {
  //   if (char === 'a')
  //     return findA
  //   else
  //     return start
  // }
  // function end(char) {
  //   return end
  // }
  // function findA(char) {
  //   if (char === 'b')
  //     return findB
  //   else
  //     return start(char)
  // }
  // function findB(char) {
  //   if (char === 'c')
  //     return findC
  //   else
  //     return start(char)
  // }
  // function findC(char) {
  //   if (char === 'd')
  //     return findD
  //   else
  //     return start(char)
  // }
  // function findD(char) {
  //   if (char === 'e')
  //     return findE
  //   else
  //     return start(char)
  // }
  // function findE(char) {
  //   if (char === 'f')
  //     return end
  //   else
  //     return start
  // }
  // console.log(match("I aabcdefghm grood."))
  // console.log(match("I aacdefghm grood."))

  // function match(string) {
  //   let state = start
  //   for (let char of string) {
  //     state = state(char)
  //   }
  //   return state === end
  // }
  // function start(char) {
  //   if (char === 'a')
  //     return findA
  //   else
  //     return start
  // }
  // function end(char) {
  //   return end
  // }
  // function findA(char) {
  //   if (char === 'b')
  //     return findB
  //   else
  //     return start(char)
  // }
  // function findB(char) {
  //   if (char === 'c')
  //     return findC
  //   else
  //     return start(char)
  // }
  // function findC(char) {
  //   if (char === 'a')
  //     return findA2
  //   else
  //     return start(char)
  // }
  // function findA2(char) {
  //   if (char === 'b')
  //     return findB2
  //   else
  //     return start(char)
  // }
  // function findB2(char) {
  //   if (char === 'x')
  //     return end
  //   else
  //     return findB(char)
  // }
  // console.log(match("I aabcabcabx grood."))
  // console.log(match("I aabcabcabcabx grood."))
  // console.log(match("I aabcabcabxabx grood."))
  // console.log(match("I aabcabcababx grood."))


  // function match(string) {
  //   let state = start
  //   for (let char of string) {
  //     state = state(char)
  //   }
  //   return state === end
  // }
  // function start(char) {
  //   if (char === 'a')
  //     return findA1
  //   else
  //     return start
  // }
  // function end(char) {
  //   return end
  // }
  // function findA1(char) {
  //   if (char === 'b')
  //     return findB1
  //   else
  //     return start(char)
  // }
  // function findB1(char) {
  //   if (char === 'a')
  //     return findA2
  //   else
  //     return start(char)
  // }
  // function findA2(char) {
  //   if (char === 'b')
  //     return findB2
  //   else
  //     return start(char)
  // }
  // function findB2(char) {
  //   if (char === 'a')
  //     return findA3
  //   else
  //     return start(char)
  // }
  // function findA3(char) {
  //   if (char === 'b')
  //     return findB3
  //   else
  //     return start(char)
  // }
  // function findB3(char) {
  //   if (char === 'x')
  //     return end
  //   else
  //     return findB2(char)
  // }
  // console.log(match("I aababababx grood."))
  // console.log(match("I aabababababx grood."))
  // console.log(match("I aababaeababx grood."))
  // console.log(match("I aabababaabx grood."))


  function prefixTable(pattern, prefix, n) {
    prefix[0] = 0; // prefix 初始
    let len = 0; // 最长公共前后缀长度
    let i = 1;
    while(i < n) {
      if (pattern[i] == pattern[len]) {
        len ++;
        prefix[i] = len;
        i ++;
      } else {
        if (len > 0) {
          len = prefix[len - 1]
        }
        else {
          prefix[i] = len
          i ++
        }
      }
    }
    return prefix

  }

  function movePrefixTable(prefix, n) {
    for (let i = n - 1; i > 0; i --) {
      prefix[i] = prefix[i - 1]
    }
    prefix[0] = -1
    return prefix
  }

  function kmpSearch(text, pattern) {
    const patternArray = pattern.split("")
    let n = patternArray.length
    const textArray = text.split("")
    let m = textArray.length

    let prefixArray = new Array(n)
    const prefixTemp = prefixTable(pattern, prefixArray, n)
    const prefix = movePrefixTable(prefixTemp, n)

    // textArray len m
    // pattern len n

    let i = 0, j = 0;
    while(i < m) {
      if (j == n - i && textArray[i] == pattern[j]) {
        console.log("Found pattern at ", i - j)
        j = prefix[j]
      }
      if (textArray[i] == pattern[j]) {
        i ++;
        j ++;
      } else {
        j = prefix[j]
        if (j == -1) {
          i ++;
          j ++;
        }
      }
    }
  }

  kmpSearch("ABABABABCABAAB", "ABABCABAA")

  // const prefixTemp = prefixTable("ABABCABAA", new Array(9), 9)
  // const prefix = movePrefixTable(prefixTemp, 9)

  // function match(pattern, string) {

  // }
  // match("abababx", "I aababababx grood.")
</script>